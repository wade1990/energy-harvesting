% !TEX root = OptimalOffline.tex

\begin{lemma}
The transmission power in an optimal solution $\{\textbf{p},\textbf{s},N\}$ to Problem 1 is non-decreasing with time whenever the receiver is '\textit{on}' i.e. $p_i\ge p_j$ for all $i\in \{1,2..N\},j<i$ if $p_i\neq 0$. 
\label{lemma_increasing_power}
\end{lemma}
\begin{proof}
We prove this by contradiction. Assume that the optimal solution $\{\textbf{p},\textbf{s},N\}$ does not follow the condition stated in Lemma \ref{lemma_increasing_power}. Let $i$ be the minimum index for which the condition is violated. So, $\exists j<i:\ p_i<p_j $. Let $j$ be the maximum index less than $i$ such that $p_i<p_j$. 

%
%\begin{lemma}
%The transmission power in every optimal solution to Problem 1 is non-decreasing with time whenever the receiver is \textit{on}.
%\label{lemma_increasing_power}
%\end{lemma}
%\begin{proof}
%We prove this by contradiction. The following two cases arise depending on whether the receiver is \textit{on} or \textit{off}.

$Case 1:$ Suppose $j=i-1$. This situation is shown in Fig. \ref{Lemma1}. In this case consider a new transmission policy which is same as the optimal policy till time $s_{i-1}$. From $s_{i-1}$ to $s_{i+1}$ this new policy transmits at a constant power $p'=\dfrac{p_i(s_{i+1}-s_{i})+p_{i-1}(s_{i}-s_{i-1})}{s_{i+1}-s_{i-1}}$. Then the number of bits transmitted in this new policy till $s_{i+1}$ would be more than the optimal policy, due to concavity of $g(p)$ as shown below.
\begin{align*}
&g(p_i)\frac{s_{i+1}-s_{i}}{s_{i+1}-s_{i-1}}+g(p_{i-1})\frac{s_{i}-s_{i-1}}{s_{i+1}-s_{i-1}}
\\ 
&\le g\left(\frac{p_i(s_{i}-s_{i-1})+p_{i-1}(s_{i+1}-s_{i})}{s_{i+1}-s_{i-1}}\right),
\\
&\implies g(p')(s_{i+1}-s_{i-1})
\\
&\ge g(p_i)(s_{i+1}-s_{i})+g(p_{i-1})(s_{i}-s_{i-1}).  
\end{align*}
After time $s_{i+1}$, the policy that we are describing follows same transmission powers as the optimal policy till it transmits $B_0$ bits. Since the policy has transmitted more number of bits than the optimal policy till time $s_{i+1}$, it would finish transmitting all $B_0$ bits at an earlier time than the optimal policy. Hence, this new policy contradicts the optimality of policy $\{\textbf{p},\textbf{s},N\}$.

$Case 2:$ When $j<i-1$, by our assumption on choosing $j$, $p_i>p_{i-1},..,p_{j+1}$ and $p_i<p_{j}$. As $i$ is the minimum index violating the condition stated in Lemma \ref{lemma_increasing_power}, we can argue that $p_{i-1},..,p_{j+1}=0$. This situation is shown in Fig. \ref{Lemma1}. Now, consider a policy where the transmission power is same as the optimal policy before time $s_j$ and after time $s_{i+1}$. From $s_j$ to $s_j'=s_j+s_{i}-s_{j+1}$ the policy keeps the receiver \textit{off} and from $s_j'$ to $s_{i}$ it transmits at power $p_j$. This policy still transmits same number of bits and ends at the same time as the optimal policy. This policy matches with the form of optimal policy in \textit{Case1}. From this policy we can generate another policy which would finish earlier than the optimal policy as we did is \textit{Case1} and reach a contradiction. 
\end{proof}

\begin{figure}[htb]
  \centering
  \centerline{\includegraphics[width=8cm]{Lemma1.pdf}}
\caption{Figure showing the two cases of Lemma \ref{lemma_increasing_power}, \textit{Case 1} (left)  and \textit{Case2} (right) with $p_i>p_j$.}\label{Lemma1}
\end{figure}

\begin{lemma}
The optimal solution to Problem 1 may not be unique, but there always exists an optimal solution where once transmission has started, the receiver remains '\textit{on}' until the transmission is complete. \label{lemma_nobreaks}
\end{lemma}
\begin{proof}
The proof involves showing that we can generate an optimal solution with no breaks in transmission from any other optimal solution. Let the optimal policy be $\{\textbf{p},\textbf{s},N\}$. Now, if $p_i\neq 0,\forall \ i$, then we are done. Suppose some of $p_i$'s, say $p_{i_1},p_{i_2},...,p_{i_k}=0$ for some $k<N$, where $i_1<i_2<..<i_k$. Let $p_j$ be the first non-zero power after $p_{i_1}$. Consider a new policy which is same as policy $\{\textbf{p},\textbf{s},N\}$ till time $s_{i_1-1}$ and after time $s_{j}$. But, it keeps the receiver \textit{off} for a period of $(s_{j}-s_{i_1})$ starting from time $s_{i_1-1}$ and transmit with power $p_{i_1-1}$ from time $s_j'=(s_{i_1-1}+s_{j}-s_{i_1})$ till $s_j$. This policy transmits same amount of bits in same time as policy $\{\textbf{p},\textbf{s},N\}$ and also satisfies all constraints. So this policy is also optimal. But, in this policy the receiver \textit{off} duration, $(s_{j}-s_{i_1})$, has been shifted to left as shown in Fig.\ref{fig_Lemma2} (a). We continue this process of shifting the receiver \textit{off} period to left again and again to generate new optimal  policies till we reach a policy where the receiver is \textit{off} for time $(s_{j}-s_{i_1})$ from $s_1$ as shown in Fig. \ref{fig_Lemma2} (b). The start time of this policy (the one showed with solid line in Fig. \ref{fig_Lemma2} (b)) can now be changed to $s_1'=(s_1+s_{j}-s_{i_1})$. 

Similarly, we shift the receiver \textit{off} period corresponding to $p_{i_2},...,p_{i_k}$ till the total \textit{off} period is shifted to the beginning of transmission. This will result in a policy which starts after time $s_1$ and ends at time $s_{N+1}$, but the transmission power never goes zero in-between. Such a policy is also optimal and has no breaks.
\end{proof}
\begin{figure}[htb]
  \centering
  \centerline{\includegraphics[width=8cm]{Lemma2.eps}}
\caption{Illustration of Lemma \ref{lemma_nobreaks}. Receiver \textit{off} time of $s_{j}-s_{i_1}$ is progressively shifted to left as shown in (a) to (b).}\label{fig_Lemma2}
\end{figure}
In rest of the paper, whenever we refer to the optimal solution for Problem 1, we assume it is the one with no breaks in transmission.
%This is equivalent to saying that there are no breaks during transmission in an optimal solution. Again, we shall prove this by contradiction. In the optimal solution, suppose the receiver is \textit{off} for some period after transmission starts. Let the transmission power before the break is $p_1$ and after the break is $p_2$. Considering Lemma \ref{lemma_increasing_power}, $p_1<p_2$, as shown in Fig. \ref{Lemma2_figure} (a). Consider the policy where we keep the receiver \textit{off} from time $A$ to $B'=(A+C-B)$. Now, an energy arrival can occur at the transmitter at any time between $A$ to $D$. If there is no energy arrival then transmitting at a constant rate from $B'$ to $D$ would transmit more bits.
%
%$Case 1:$ If the energy arrival is between $A$ and $B'$, then it can be easily seen that transmitting at a constant rate from $B'$ to $D$ would be better due to concavity of $g(p)$.
%
%$Case 2:$ If the arrival is between $B'$ and $C$ (say $C'$), then again transmitting at a same rate $p_1$ from $B'$ to $C'$ and  at a constant rate from $C'$ to $D$ would deliver more number of bits. In the worst case, an energy arrival occurring at $C$ would make this scenario transmit equal number of bits as the original scenario.
%
%$Case 3:$ If there is an energy arrival from $C$ to $D$ (say $D'$), then transmitting at maximum possible constant power form $B'$ to $D'$ and then at same rate $p_2$ from $D'$ to $D$ would deliver more bits to the receiver.
%
%Applying the above scenarios iteratively we could shift the receiver \textit{off} duration $(C-B)$ to the beginning of transmission and still, at worst case, transmit equal number of bits in same total time. Hence having a break in between transmission is always discouraged. This also gives us an idea of why the optimal solution may not be unique.
%\end{proof}
%
%\begin{figure}[htb]
%\centering
%\centerline{\includegraphics[width=8cm]{Lemma2.pdf}}
%\caption{Figure showing the three cases of Lemma \ref{lemma_nobreaks}, (a) the original scenario, (b) \textit{Case 1}, (c) \textit{Case 2} and (d) \textit{Case3} with $p_1>p_2$.}
%\label{Lemma2_figure}
%\end{figure}

\begin{lemma}
In an optimal solution with no breaks, the transmission power can only change at the time instants when energy arrives at the transmitter. The total energy used for transmission till that instant equals the total energy harvested upto that instant. The time instant where the transmission policy ends also satisfies this property.
\label{lemma_energy_consumed} 
\end{lemma}
\begin{proof}
Keeping in mind Lemma \ref{lemma_increasing_power} and \ref{lemma_nobreaks}, in the optimal solution $\{\textbf{p}, \textbf{s}, N\}$, transmission starts at $s_1$ and ends at $s_{N+1}$ without stopping in-between. Further, the transmission powers are also increasing. Assuming such a structure, the proof of this Lemma can be argued in similar terms of Lemma 2,3 in \cite{Yang}. 
\end{proof}	

\begin{lemma}
Consider two policies $\{\textbf{p},\textbf{s},N\}$  and $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$ ,which are feasible with respect to energy constraint \eqref{pb1_constraint_bits}, have non-decreasing powers and transmit same number of bits in total. If $\widetilde{p}_1=p_1-\alpha,\widetilde{p}_2=p_2,..,\widetilde{p}_{N-1}=p_{N-1},\widetilde{p}_N=p_N+\beta $ and $\widetilde{s}_1=s_1-\gamma,\widetilde{s}_2=s_2,..,\widetilde{s}_{N-1}=s_{N-1},\widetilde{s}_N=s_N+\delta $, where $\gamma=\dfrac{\alpha}{p_1-\alpha}(s_2-s_1)$, $\delta =\dfrac{\beta}{p_N+\beta}(s_{N+1}-s_N)$ and $\alpha ,\beta$ are positive constants, then 
\begin{equation}
(\widetilde{s}_{N+1}-\widetilde{s}_1)>(s_{N+1}-s_1).
\end{equation}
\label{lemma_increase_time}
\end{lemma}
\begin{proof}
The two policies $\{\textbf{p},\textbf{s},N\}$  and $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$ are shown in Fig. \ref{lemma4}. For every $\beta$ we can find a value of $\alpha$ such that the number of bits transmitted in policy $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$ remains the same as policy $\{\textbf{p},\textbf{s},N\}$. So, excluding the common parts in the transmission policy $\{\textbf{p},\textbf{s},N\}$ and $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$, we can equate
\begin{align}
&g(p_N)(s_{N+1}-s_N)+g(p_1)(s_2-s_1)\nonumber
\\
&=g(\widetilde{p}_N)(\widetilde{s}_{N+1}-\widetilde{s}_N)+g(\widetilde{p}_1)(\widetilde{s}_2-\widetilde{s}_1)\nonumber,
\\
&\implies (p_N+\beta)p_N\frac{\delta}{\beta}\left(\frac{g(p_N)}{p_N}-\frac{g(p_N+\beta)}{p_N+\beta}\right)\nonumber
\\
&=(p_1-\alpha)p_1\frac{\gamma}{\alpha}\left(\frac{g(p_1-\alpha)}{p_1-\alpha}-\frac{g(p_1)}{p_1}\right).\label{bits_equal}
\end{align}
$\exists$ $p_N':p_N<p_N'<p_{N}+\beta$ and $p_1':p_1-\alpha<p_1'<p_{1}$ such that
\begin{align}
&\frac{d}{dp} \frac{g(p)}{p} \bigg{\vert}_{p=p_N'}=\frac{1}{\beta}\left(\frac{g(p_N+\beta)}{p_N+\beta}-\frac{g(p_N)}{p_N}\right),\label{diff_1}
\\
&\frac{d}{dp} \frac{g(p)}{p}\bigg{\vert}_{p=p_1'}=-\frac{1}{\alpha}\left(\frac{g(p_1-\alpha)}{p_1-\alpha}-\frac{g(p_1)}{p_1}\right)\label{diff_2}.
\end{align}
Substituting (\ref{diff_1}) and (\ref{diff_2}) into (\ref{bits_equal}) we get,
\begin{align}
&\delta(p_N+\beta)p_N\frac{d}{dp} \frac{g(p)}{p}  \bigg{\vert}_{p=p_N'}
=\gamma(p_1-\alpha)p_1\frac{d}{dp} \frac{g(p)}{p} \bigg{\vert}_{p=p_1'}.\label{bits_equal1}
\end{align}
It can be verified that $\dfrac{d}{dp} \dfrac{g(p)}{p}$ is a decreasing function of $p$ using \eqref{property_concave}. As $p_1'<p_N'$, equation (\ref{bits_equal1}) implies $\gamma >\delta$. Hence the time for which transmission occurs in the policy $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$, $\left( s_{N+1}-s_1+\gamma-\delta\right)$, is greater than transmission time in policy $\{\textbf{p},\textbf{s},N\}$ i.e. $(s_{N+1}-s_1)$.
\end{proof}
\begin{figure}
\centering
  \centerline{\includegraphics[width=8cm]{Lemma4.eps}}
\caption{Illustration of the proof of Lemma \ref{lemma_increase_time}.}\label{lemma4}
\end{figure}

\begin{lemma}
If the receiver has energy to stay \textit{'on'} for $\TRx_0$ time, then either the transmitter will transmit for the entire duration $\TRx_0$ or the transmitter will begin transmission at time $t=0$, in which case it stays \textit{on} for less than or equal to $\TRx_0$ time. 
\label{transmission_duration}
\end{lemma}
\begin{proof}
We will prove this by contradiction. Suppose the optimal transmission policy $\{\textbf{p},\textbf{s},N\}$ does not begin transmitting at time $t=0$ and transmits for a duration $(s_{N+1}-s_1)< \TRx_0$. Now, consider a policy $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$ as defined in Lemma \ref{lemma_increase_time}. By Lemma \ref{lemma_energy_consumed}, policy $\{\textbf{p},\textbf{s},N\}$ exhausts all energy at epochs $s_i$'s. So, $s_{2}$ is the first energy arrival which is on the boundary of energy constraint (\ref{pb1_constraint_energy}) i.e. $U(s_2)=\ETx(s_2^-)$ and $s_{N}$ is the last epoch satisfying $U(s_N)=\ETx(s_N^-)$. Hence we can choose $\alpha ,\beta$ such that policy $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$ would be feasible with respect energy constraint (\ref{pb1_constraint_energy}). By Lemma \ref{lemma_increase_time}, the time for which transmission occurs in the policy $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$, $\left( \widetilde{s}_{N+1}-\widetilde{s}_1\right)$, is greater than transmission time in policy $\{\textbf{p},\textbf{s},N\}$ i.e. $(s_{N+1}-s_1)$. As $s_{N+1}-s_1<\TRx_0$, we can further reduce $\alpha,\beta$ to arbitrarily small positive values so that $(s_{N+1}-s_1)<\left( \widetilde{s}_{N+1}-\widetilde{s}_1\right)<\TRx_0$ holds. With this choice of $\alpha,\beta$, policy $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$ is feasible with constraints  (\ref{pb1_constraint_bits}), (\ref{pb1_constraint_energy}), (\ref{pb1_constraint_time}) and contradicts the optimality of policy $\{\textbf{p},\textbf{s},N\}$ (as $\{\bm{\widetilde{p}},\bm{\widetilde{s}},N\}$ finishes before the optimal policy). This concludes that $s_{N+1}-s_1=\TRx_0$ (if $s_1\neq 0$) in optimal policy.
\end{proof}